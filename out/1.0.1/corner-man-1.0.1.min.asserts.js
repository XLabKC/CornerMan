/**
 * CornerMan JavaScript library v1.0.1
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */
(function(){(function(e){var t;t={},e.cm={inherit:function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},define:function(e,r){var e=e.replace(/\./g,"$");if(t[e])throw Error("Namespace already exists: "+e);t[e]=r},require:function(e){var e=e.replace(/\./g,"$");if(!t[e])throw Error("Unknown namespace: "+e);return t[e]}}})(this),function(){var e,t,r,n;function i(e){this.id_=i.generateKey(r),this.template_=ko.observable(e||null),this.hasTemplate=ko.pureComputed(this.computeHasTemplate_.bind(this)),this.parent_=ko.observable(null),this.parent_.subscribe(this.onParentWillChange_,this,"beforeChange"),this.parent_.subscribe(this.onParentChanged_,this,"change"),this.keys_=ko.observableArray(),this.keysToChildrenObservables_={},this.childrenObservable_=ko.pureComputed(this.computeChildrenObservable_.bind(this)),this.eventsToListeners_={},this.childrenIdsToKeys_={}}e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=10,r=16,i.Events={CHILD_ADDED:"child-added",CHILD_MOVED:"child-moved",CHILD_REMOVED:"child-removed",MOVED_KEYS:"self-moved-keys",ADDED_TO_PARENT:"self-added-to-parent",REMOVED_FROM_PARENT:"self-removed-from-parent"},i.generateKey=function(){var r,n,i;for(r=t,n=e,1===arguments.length&&"number"==typeof arguments[0]?r=arguments[0]:1===arguments.length&&"string"==typeof arguments[0]?n=arguments[0]:2===arguments.length&&(r=arguments[0],n=arguments[1]),keySegments=[],i=0;r>i;i++)keySegments.push(n.charAt(Math.floor(Math.random()*n.length)));return keySegments.join("")},i.createChildObservable=function(e,t,r){t=t||i.generateKey();var n=ko.pureComputed({read:function(){return e.getChildrenForKey(t)[0]||null},write:function(r){e.getChildrenForKey(t)[0]!==r&&e.replaceChildrenAtKey(t,r?[r]:[])},owner:e});return n.key_=t,n.viewModel_=e,n.getKey=function(){return n.key_},n.getViewModel=function(){return n.viewModel_},n(r),n},i.createChildrenObservable=function(e,t,r){var i=ko.observableArray();return i.subscribe(n.bind(e,e,t),null,"arrayChange"),i.key_=t,i.viewModel_=e,i.getKey=function(){return i.key_},i.getViewModel=function(){return i.viewModel_},r&&i(r),i},i.prototype.childObservable=function(e,t){var r,n;return t=t||{},r=t.key||i.generateKey(),n=t.viewModel||this,i.createChildObservable(n,r,e)},i.prototype.childrenObservable=function(e,t){var r,n;return t=t||{},r=t.key||i.generateKey(),n=t.viewModel||this,i.createChildrenObservable(n,r,e)},i.prototype.addListener=function(e,t){this.eventsToListeners_[e]||(this.eventsToListeners_[e]=[]),this.eventsToListeners_[e].push(t)},i.prototype.removeListener=function(e){var t,r,n,i;t=!1;for(r in this.eventsToListeners_)for(n=this.eventsToListeners_[r],i=0;n.length>i;i++)e===n[i]&&(t=!0,n.splice(i,1),i--);return t},i.prototype.getParent=function(){return this.parent_()},i.prototype.getTemplate=function(){return this.template_()},i.prototype.getKeys=function(){return this.keys_()},i.prototype.getKeysObservable=function(){return this.keys_},i.prototype.getChildren=function(){return this.childrenObservable_()},i.prototype.getChildrenObservable=function(){return this.childrenObservable_},i.prototype.getChildrenForKey=function(e){return this.getChildrenObservableForKey(e)()},i.prototype.getChildrenObservableForKey=function(e){return this.keysToChildrenObservables_[e]||(this.keysToChildrenObservables_[e]=ko.observableArray([]),this.keys_.push(e)),this.keysToChildrenObservables_[e]},i.prototype.getKeyForChild=function(e){return e.getParent()!=this?null:this.childrenIdsToKeys_[e.id_]||null},i.prototype.addChildAtKey=function(e,t){var r,n,o;return r=t.getParent(),r===this?(n=r.getKeyForChild(t),n===e?!1:(this.removeChildAtKeySilently_(n,t,!1),this.keysToChildrenObservables_[e]?this.keysToChildrenObservables_[e].push([t]):(this.keysToChildrenObservables_[e]=ko.observableArray([t]),this.keys_.push(e)),this.childrenIdsToKeys_[t.id_]=e,t.dispatchEvent_(i.Events.MOVED_KEYS,this,n,e),this.dispatchEvent_(i.Events.CHILD_MOVED,t,n,e),!0)):(o=!this.keysToChildrenObservables_[e],o?(this.keysToChildrenObservables_[e]=ko.observableArray([t]),this.keys_.peek().push(e)):this.keysToChildrenObservables_[e].peek().push(t),this.childrenIdsToKeys_[t.id_]=e,r&&(n=r.getKeyForChild(t),r.removeChildAtKeySilently_(n,t,!0)),t.parent_(this),o?this.keys_.valueHasMutated():this.keysToChildrenObservables_[e].valueHasMutated(),!0)},i.prototype.addChildrenAtKey=function(e,t){for(var r=0,n=t.length;n>r;r++)this.addChildAtKey(e,t[r])},i.prototype.addChild=function(e){var t=i.generateKey();return this.addChildAtKey(t,e),t},i.prototype.addChildren=function(e){var t=i.generateKey();return this.addChildrenAtKey(t,e),t},i.prototype.removeChildAtKey=function(e,t){var r=this.removeChildAtKeySilently_(e,t,!0);return r&&t.parent_(null),r},i.prototype.removeChild=function(e){var t=this.getKeyForChild(e);return t?this.removeChildAtKey(t,e):!1},i.prototype.replaceChildrenAtKey=function(e,t){var r,n,i;for(r=this.getChildrenForKey(e),n=0,i=r.length;i>n;n++)this.removeChildAtKey(e,r[n]);this.addChildrenAtKey(e,t)},i.prototype.computeChildrenObservable_=function(){var e,t,r,n;for(e=this.keys_(),e.sort(),t=[],r=0,n=e.length;n>r;r++)t=t.concat(this.getChildrenForKey(e[r]));return t},i.prototype.computeHasTemplate_=function(){return null!=this.template_()},i.prototype.removeChildAtKeySilently_=function(e,t,r){if(!this.keysToChildrenObservables_[e])return!1;var n=this.keysToChildrenObservables_[e].remove(t);return n&&n.length?(r||delete this.childrenIdsToKeys_[t.id_],!0):!1},i.prototype.dispatchEvent_=function(){var e,t,r,n,i;if(e=arguments[0],t=Array.prototype.slice.call(arguments,1),r=this.eventsToListeners_[e])for(n=0,i=r.length;i>n;n++)r[n].apply(this,t)},i.prototype.onParentWillChange_=function(e){if(e){var t=e.childrenIdsToKeys_[this.id_];t&&(delete e.childrenIdsToKeys_[this.id_],this.dispatchEvent_(i.Events.REMOVED_FROM_PARENT,e,t),e.dispatchEvent_(i.Events.CHILD_REMOVED,this,t))}},i.prototype.onParentChanged_=function(e){if(e){var t=e.getKeyForChild(this);this.dispatchEvent_(i.Events.ADDED_TO_PARENT,e,t),e.dispatchEvent_(i.Events.CHILD_ADDED,this,t)}},n=function(e,t,r){var n,i,o,s,l,a,h;for(n=0,i=r.length;i>n;n++){for(o=r[n],s=!1,l=0,a=r.length;a>l;l++)if(h=r[l],"added"===h.status&&"deleted"===o.status||"deleted"===h.status&&"added"===o.status){s=!0;break}s||("added"===o.status?e.addChildAtKey(t,o.value):"deleted"===o.status&&e.removeChildAtKey(t,o.value))}},cm.define("viewmodels.ViewModel",i)}(),function(){var e,t,r,n,i;e=cm.require("viewmodels.ViewModel"),t=function(e){var e=e;return function(){return e}},r=function(e,t){var r=function(e){return e.getTemplate()};return function(){return{name:r,foreach:e,"if":t,templateEngine:ko.cornerManTemplateEngine||null}}},n=function(n,i,o,s){var l,a,h,u,d,c;return(l=ko.unwrap(i()))?(a=null,h=null,u=!0,d=function(t){if(t instanceof e)a=t;else if(t instanceof Array)if(s)h=t;else if(a=t[0],!a)return null},l instanceof e||l instanceof Array?d(l):"string"==typeof l?d(o.getChildrenForKey(l)):(c="string"==typeof l.data?o.getChildrenForKey(l.data):l.data,d(c),u=l["if"]?l["if"]:u),a?t({name:a.template_,data:a,"if":u,templateEngine:ko.cornerManTemplateEngine||null}):h?r(h,u):t({})):null},i=function(){var e,t;e=ko.bindingHandlers.template.init,t=ko.bindingHandlers.template.update,ko.bindingHandlers.child={init:function(t,r,i,o,s){var l=n(t,r,s.$data,!1);return l?e(t,l,i,o,s):void 0},update:function(e,r,i,o,s){var l=n(e,r,s.$data,!1);return l?t(e,l,i,o,s):void 0}},ko.bindingHandlers.children={init:function(t,r,i,o,s){var l=n(t,r,s.$data,!0);return l?e(t,l,i,o,s):void 0},update:function(e,r,i,o,s){var l=n(e,r,s.$data,!0);return l?t(e,l,i,o,s):void 0}}},cm.define("bindings.Child",{attachToKnockout:i})}(),function(){function e(e,t){var e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");this.slugs_=(e.match(/\/:(\w+)/g)||[]).map(function(e){return e.substring(2)}),this.regex_=RegExp(e.replace(/\/:(\w+)/g,"/([\\w-]+)")),this.callbacks_=t}e.prototype.attemptToHandleUrl=function(e){var t,r,n,i,o,s,l,a,h;if(this.regex_.lastIndex=0,t=e.replace(/\?.*/,""),"/"==t[t.length-1]&&(t=t.substring(0,t.length-1)),r=e.match(/\?.*/),n=r&&r[0]?r[0]:"",i=this.regex_.exec(t),null!=i&&i[0].length==t.length){if(o={},this.slugs_)for(o.params={},s=0,l=this.slugs_.length;l>s;s++)o.params[this.slugs_[s]]=i[s+1];if(n.length)for(o.query={},a=n.match(/[\w=$+%@#^()]+/g),s=0,l=a.length;l>s;s++)h=a[s].split("="),o.query[h[0]]=h[1]||!0;return this.fireCallbacks_(o),!0}return!1},e.prototype.fireCallbacks_=function(e){var t,r,n;t=0,r=this.callbacks_.length,n=function(){t++,r>t&&this.callbacks_[t](e,n)}.bind(this),this.callbacks_[t](e,n)},cm.define("router.Route",e)}(),function(){function e(e){this.on404_=e||function(e){console.log("404 at",e)},this.routes_=[],this.historyLength_=0}var t=cm.require("router.Route");e.prototype.setOn404=function(e){this.on404_=e},e.prototype.get=function(){var e,r;e=arguments[0],r=Array.prototype.slice.call(arguments,1),this.routes_.push(new t(e,r))},e.prototype.registerRoute=e.prototype.get,e.prototype.listen=function(){window.addEventListener("popstate",function(){this.historyLength_-=1,this.notify_(this.currentUrlWithoutOrigin_())}.bind(this));var e=this;$(document).on("click","[href]",function(t){href=this.getAttribute("href"),0!=href.indexOf("http")&&(t.preventDefault(),e.navigate(href))}),this.notify_(this.currentUrlWithoutOrigin_())},e.prototype.navigate=function(e){this.addOriginIfNeeded_(e)!=window.location.href&&window.history&&window.history.pushState&&(history.pushState(null,"",e),this.historyLength_+=1,this.notify_(e))},e.prototype.hasHistory=function(){return this.historyLength_>0},e.prototype.back=function(){window.history.back()},e.prototype.notify_=function(e){for(var t=0,r=this.routes_.length;r>t;t++)if(this.routes_[t].attemptToHandleUrl(e))return;this.on404_(e)},e.prototype.currentUrlWithoutOrigin_=function(){return window.location.href.replace(this.getOrigin_(),"")},e.prototype.addOriginIfNeeded_=function(e){return 0==e.indexOf("http")?e:(e="/"==e[0]?e:"/"+e,this.getOrigin_()+e)},e.prototype.getOrigin_=function(){return window.location.origin},cm.define("router.Router",e)}(),function(){function e(e,r){"number"==typeof e&&(r=arguments[0],e=""),t.call(this,e),this.order_=ko.observable(r)}var t=cm.require("viewmodels.ViewModel");cm.inherit(e,t),e.prototype.getOrder=function(){return this.order_()},e.prototype.setOrder=function(e){this.order_(e)},cm.define("viewmodels.ControlViewModel",e)}(),function(){var e,t,r,n;function i(t){e.call(this,t),this.keysToControlsObservables_={}}e=cm.require("viewmodels.ViewModel"),t=cm.require("viewmodels.ControlViewModel"),r="control_key:",cm.inherit(i,e),i.prototype.getControlsForKey=function(e){return this.getControlsObservableForKey(e)()},i.prototype.getControlsObservableForKey=function(e){return this.getControlsObservableForKeyInternal_(r+e)},i.prototype.addControlAtKey=function(e,t){this.addChildAtKey(r+e,t)},i.prototype.removeControlAtKey=function(e,t){return this.removeChildAtKey(r+e,t)},i.prototype.getControlsObservableForKeyInternal_=function(e){return this.keysToControlsObservables_[e]||(this.keysToControlsObservables_[e]=ko.pureComputed(this.computeControls_.bind(this,e))),this.keysToControlsObservables_[e]},i.prototype.computeControls_=function(e){var t,o,s,l,a,h,u,d,c,p;for(t=this.getChildrenForKey(e),o=this.getKeys(),s=0,l=o.length;l>s;s++)if(a=o[s],0!=a.indexOf(r))for(h=this.getChildrenForKey(a),u=0,d=h.length;d>u;u++)c=h[u],c instanceof i&&(p=c.getControlsObservableForKeyInternal_(e),t=t.concat(p()));return t.sort(n),t},n=function(e,t){var r,n;return r=e.getOrder(),n=t.getOrder(),n>r?-1:r==n?0:1},cm.define("viewmodels.ContentViewModel",i)}(),function(){var e,t,r;function n(e){this.router=new t,this.rootViewModel_=ko.observable(e)}e=cm.require("viewmodels.ViewModel"),t=cm.require("router.Router"),r=cm.require("bindings.Child"),n.prototype.getRootViewModel=function(){return this.rootViewModel_()},n.prototype.setRootViewModel=function(e){this.rootViewModel_(e)},n.prototype.get=function(){var e,t,r;for(e=Array.prototype.slice.call(arguments,1),t=0,r=e.length;r>t;t++)e[t]=e[t].bind(this);this.router.get.apply(this.router,arguments)},n.prototype.registerRoute=n.prototype.get,n.prototype.listen=function(){this.router.listen()},n.prototype.setTemplateEngine=function(e){ko.cornerManTemplateEngine=e},n.prototype.bindRootViewModel=function(e){r.attachToKnockout(),e=e||document.body,e.setAttribute("data-bind","child: rootViewModel_"),ko.applyBindings(this)},cm.define("CornerMan",n)}(this),function(e){var t,r;t=cm.require("viewmodels.ViewModel"),r=cm.require("CornerMan"),e.CornerMan={CornerMan:r,Router:cm.require("router.Router"),ContentViewModel:cm.require("viewmodels.ContentViewModel"),ControlViewModel:cm.require("viewmodels.ControlViewModel"),ViewModel:t,Events:t.Events},e.CornerMan.createChildObservable=t.createChildObservable,e.CornerMan.createChildrenObservable=t.createChildrenObservable,e.CornerMan.create=function(e){return new r(e)},e.CornerMan.inherit=cm.inherit}(this)})();