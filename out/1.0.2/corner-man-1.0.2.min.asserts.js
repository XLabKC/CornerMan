/**
 * CornerMan JavaScript library v1.0.2
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */
(function(){(function(e){var t,r,n;t={},e.cm={inherit:function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},define:function(e,r){var e=e.replace(/\./g,"$");if(t[e])throw Error("Namespace already exists: "+e);t[e]=r},require:function(e){var e=e.replace(/\./g,"$");if(!t[e])throw Error("Unknown namespace: "+e);return t[e]}},r=function(){},n=e.insist||{},e.cm.assertArgs=e.assertArgs||n.args||r,e.cm.assertOfType=e.assertOfType||n.ofType||r,e.cm.assertType=e.assertType||n.isType||r,e.cm.getNameForValue=e.getNameForValue||n.getNameForValue||r,e.cm.getNameForType=e.getNameForType||n.getNameForType||r,e.cm.arrayOf=e.arrayOf||n.arrayOf||r,e.cm.nullable=e.nullable||n.nullable||r,e.cm.anything=e.anything||n.anything||r,e.cm.optional=e.optional||n.optional||r,e.cm.ofEnum=e.ofEnum||n["enum"]||r})(this),function(){var e,t,r,n;function s(e){cm.assertArgs(arguments,cm.optional(String)),this.id_=s.generateKey(r),this.template_=ko.observable(e||null),this.hasTemplate=ko.pureComputed(this.computeHasTemplate_.bind(this)),this.parent_=ko.observable(null),this.parent_.subscribe(this.onParentWillChange_,this,"beforeChange"),this.parent_.subscribe(this.onParentChanged_,this,"change"),this.keys_=ko.observableArray(),this.keysToChildrenObservables_={},this.childrenObservable_=ko.pureComputed(this.computeChildrenObservable_.bind(this)),this.eventsToListeners_={},this.childrenIdsToKeys_={}}e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=10,r=16,s.Events={CHILD_ADDED:"child-added",CHILD_MOVED:"child-moved",CHILD_REMOVED:"child-removed",MOVED_KEYS:"self-moved-keys",ADDED_TO_PARENT:"self-added-to-parent",REMOVED_FROM_PARENT:"self-removed-from-parent"},s.generateKey=function(){var r,n,s;for(r=t,n=e,1===arguments.length&&"number"==typeof arguments[0]?r=arguments[0]:1===arguments.length&&"string"==typeof arguments[0]?n=arguments[0]:2===arguments.length&&(r=arguments[0],n=arguments[1]),cm.assertOfType(r,Number),cm.assertOfType(n,String),keySegments=[],s=0;r>s;s++)keySegments.push(n.charAt(Math.floor(Math.random()*n.length)));return keySegments.join("")},s.createChildObservable=function(e,t,r){cm.assertArgs(arguments,s,String,cm.optional(s)),t=t||s.generateKey();var n=ko.pureComputed({read:function(){return e.getChildrenForKey(t)[0]||null},write:function(r){cm.assertArgs(arguments,cm.optional(s)),e.getChildrenForKey(t)[0]!==r&&e.replaceChildrenAtKey(t,r?[r]:[])},owner:e});return n.key_=t,n.viewModel_=e,n.getKey=function(){return n.key_},n.getViewModel=function(){return n.viewModel_},n(r),n},s.createChildrenObservable=function(e,t,r){cm.assertArgs(arguments,s,String,cm.optional(cm.arrayOf(s)));var i=ko.observableArray();return i.subscribe(n.bind(e,e,t),null,"arrayChange"),i.key_=t,i.viewModel_=e,i.getKey=function(){return i.key_},i.getViewModel=function(){return i.viewModel_},r&&i(r),i},s.prototype.childObservable=function(e,t){var r,n;return t=t||{},r=t.key||s.generateKey(),n=t.viewModel||this,s.createChildObservable(n,r,e)},s.prototype.childrenObservable=function(e,t){var r,n;return t=t||{},r=t.key||s.generateKey(),n=t.viewModel||this,s.createChildrenObservable(n,r,e)},s.prototype.addListener=function(e,t){cm.assertArgs(arguments,cm.ofEnum(s.Events),Function),this.eventsToListeners_[e]||(this.eventsToListeners_[e]=[]),this.eventsToListeners_[e].push(t)},s.prototype.removeListener=function(e){var t,r,n,s;cm.assertArgs(arguments,Function),t=!1;for(r in this.eventsToListeners_)for(n=this.eventsToListeners_[r],s=0;n.length>s;s++)e===n[s]&&(t=!0,n.splice(s,1),s--);return t},s.prototype.getParent=function(){return this.parent_()},s.prototype.getTemplate=function(){return this.template_()},s.prototype.getKeys=function(){return this.keys_()},s.prototype.getKeysObservable=function(){return this.keys_},s.prototype.getChildren=function(){return this.childrenObservable_()},s.prototype.getChildrenObservable=function(){return this.childrenObservable_},s.prototype.getChildrenForKey=function(e){return cm.assertArgs(arguments,String),this.getChildrenObservableForKey(e)()},s.prototype.getChildrenObservableForKey=function(e){return cm.assertArgs(arguments,String),this.keysToChildrenObservables_[e]||(this.keysToChildrenObservables_[e]=ko.observableArray([]),this.keys_.push(e)),this.keysToChildrenObservables_[e]},s.prototype.getKeyForChild=function(e){return cm.assertArgs(arguments,s),e.getParent()!=this?null:this.childrenIdsToKeys_[e.id_]||null},s.prototype.addChildAtKey=function(e,t){var r,n,i;return cm.assertArgs(arguments,String,s),r=t.getParent(),r===this?(n=r.getKeyForChild(t),n===e?!1:(this.removeChildAtKeySilently_(n,t,!1),this.keysToChildrenObservables_[e]?this.keysToChildrenObservables_[e].push([t]):(this.keysToChildrenObservables_[e]=ko.observableArray([t]),this.keys_.push(e)),this.childrenIdsToKeys_[t.id_]=e,t.dispatchEvent_(s.Events.MOVED_KEYS,this,n,e),this.dispatchEvent_(s.Events.CHILD_MOVED,t,n,e),!0)):(i=!this.keysToChildrenObservables_[e],i?(this.keysToChildrenObservables_[e]=ko.observableArray([t]),this.keys_.peek().push(e)):this.keysToChildrenObservables_[e].peek().push(t),this.childrenIdsToKeys_[t.id_]=e,r&&(n=r.getKeyForChild(t),r.removeChildAtKeySilently_(n,t,!0)),t.parent_(this),i?this.keys_.valueHasMutated():this.keysToChildrenObservables_[e].valueHasMutated(),!0)},s.prototype.addChildrenAtKey=function(e,t){cm.assertArgs(arguments,String,cm.arrayOf(s));for(var r=0,n=t.length;n>r;r++)this.addChildAtKey(e,t[r])},s.prototype.addChild=function(e){cm.assertArgs(arguments,s);var t=s.generateKey();return this.addChildAtKey(t,e),t},s.prototype.addChildren=function(e){cm.assertArgs(arguments,cm.arrayOf(s));var t=s.generateKey();return this.addChildrenAtKey(t,e),t},s.prototype.removeChildAtKey=function(e,t){cm.assertArgs(arguments,String,s);var r=this.removeChildAtKeySilently_(e,t,!0);return r&&t.parent_(null),r},s.prototype.removeChild=function(e){cm.assertArgs(arguments,s);var t=this.getKeyForChild(e);return t?this.removeChildAtKey(t,e):!1},s.prototype.replaceChildrenAtKey=function(e,t){var r,n,i;for(cm.assertArgs(arguments,String,cm.arrayOf(s)),r=this.getChildrenForKey(e),n=0,i=r.length;i>n;n++)this.removeChildAtKey(e,r[n]);this.addChildrenAtKey(e,t)},s.prototype.computeChildrenObservable_=function(){var e,t,r,n;for(e=this.keys_(),e.sort(),t=[],r=0,n=e.length;n>r;r++)t=t.concat(this.getChildrenForKey(e[r]));return t},s.prototype.computeHasTemplate_=function(){return null!=this.template_()},s.prototype.removeChildAtKeySilently_=function(e,t,r){if(cm.assertArgs(arguments,String,s,cm.optional(Boolean)),!this.keysToChildrenObservables_[e])return!1;var n=this.keysToChildrenObservables_[e].remove(t);return n&&n.length?(r||delete this.childrenIdsToKeys_[t.id_],!0):!1},s.prototype.dispatchEvent_=function(){var e,t,r,n,s;if(e=arguments[0],t=Array.prototype.slice.call(arguments,1),r=this.eventsToListeners_[e])for(n=0,s=r.length;s>n;n++)r[n].apply(this,t)},s.prototype.onParentWillChange_=function(e){if(e){var t=e.childrenIdsToKeys_[this.id_];t&&(delete e.childrenIdsToKeys_[this.id_],this.dispatchEvent_(s.Events.REMOVED_FROM_PARENT,e,t),e.dispatchEvent_(s.Events.CHILD_REMOVED,this,t))}},s.prototype.onParentChanged_=function(e){if(e){var t=e.getKeyForChild(this);this.dispatchEvent_(s.Events.ADDED_TO_PARENT,e,t),e.dispatchEvent_(s.Events.CHILD_ADDED,this,t)}},n=function(e,t,r){var n,s,i,o,a,l,u;for(n=0,s=r.length;s>n;n++){for(i=r[n],o=!1,a=0,l=r.length;l>a;a++)if(u=r[a],"added"===u.status&&"deleted"===i.status||"deleted"===u.status&&"added"===i.status){o=!0;break}o||("added"===i.status?e.addChildAtKey(t,i.value):"deleted"===i.status&&e.removeChildAtKey(t,i.value))}},cm.define("viewmodels.ViewModel",s)}(),function(){var e,t,r,n,s;e=cm.require("viewmodels.ViewModel"),t=function(e){var e=e;return function(){return e}},r=function(t,r){cm.assertArgs(arguments,cm.arrayOf(e),[cm.nullable(Function),Boolean]);var n=function(e){return e.getTemplate()};return function(){return{name:n,foreach:t,"if":r,templateEngine:ko.cornerManTemplateEngine||null}}},n=function(n,s,i,o){var a,l,u,c,h,d;return cm.assertArgs(arguments,Node,Function,cm.anything(),Boolean),(a=ko.unwrap(s()))?(cm.assertOfType(a,[String,e,cm.arrayOf(e),Object]),l=null,u=null,c=!0,h=function(t){if(t instanceof e)l=t;else if(t instanceof Array)if(cm.assertOfType(t,cm.arrayOf(e)),o)u=t;else if(l=t[0],!l)return null},a instanceof e||a instanceof Array?(cm.assertOfType(a,[e,cm.arrayOf(e)]),h(a)):(cm.assertOfType(i,e),"string"==typeof a?h(i.getChildrenForKey(a)):(cm.assertOfType(a,Object),d="string"==typeof a.data?i.getChildrenForKey(a.data):a.data,h(d),c=a["if"]?a["if"]:c)),l?t({name:l.template_,data:l,"if":c,templateEngine:ko.cornerManTemplateEngine||null}):u?r(u,c):t({})):null},s=function(){var e,t;e=ko.bindingHandlers.template.init,t=ko.bindingHandlers.template.update,ko.bindingHandlers.child={init:function(t,r,s,i,o){var a=n(t,r,o.$data,!1);return a?e(t,a,s,i,o):void 0},update:function(e,r,s,i,o){var a=n(e,r,o.$data,!1);return a?t(e,a,s,i,o):void 0}},ko.bindingHandlers.children={init:function(t,r,s,i,o){var a=n(t,r,o.$data,!0);return a?e(t,a,s,i,o):void 0},update:function(e,r,s,i,o){var a=n(e,r,o.$data,!0);return a?t(e,a,s,i,o):void 0}}},cm.define("bindings.Child",{attachToKnockout:s})}(),function(){function e(e,t){cm.assertArgs(arguments,String,cm.arrayOf(Function));var e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");this.slugs_=(e.match(/\/:(\w+)/g)||[]).map(function(e){return e.substring(2)}),this.regex_=RegExp(e.replace(/\/:(\w+)/g,"/([\\w-]+)")),this.callbacks_=t}e.prototype.attemptToHandleUrl=function(e){var t,r,n,s,i,o,a,l,u;if(cm.assertArgs(arguments,String),this.regex_.lastIndex=0,t=e.replace(/\?.*/,""),"/"==t[t.length-1]&&(t=t.substring(0,t.length-1)),r=e.match(/\?.*/),n=r&&r[0]?r[0]:"",s=this.regex_.exec(t),null!=s&&s[0].length==t.length){if(i={},this.slugs_)for(i.params={},o=0,a=this.slugs_.length;a>o;o++)i.params[this.slugs_[o]]=s[o+1];if(n.length)for(i.query={},l=n.match(/[\w=$+%@#^()]+/g),o=0,a=l.length;a>o;o++)u=l[o].split("="),i.query[u[0]]=u[1]||!0;return this.fireCallbacks_(i),!0}return!1},e.prototype.fireCallbacks_=function(e){var t,r,n;t=0,r=this.callbacks_.length,n=function(){t++,r>t&&this.callbacks_[t](e,n)}.bind(this),this.callbacks_[t](e,n)},cm.define("router.Route",e)}(),function(){function e(e){cm.assertArgs(arguments,cm.optional(Function)),this.on404_=e||function(e){console.log("404 at",e)},this.routes_=[],this.historyLength_=0}var t=cm.require("router.Route");e.prototype.setOn404=function(e){cm.assertArgs(arguments,Function),this.on404_=e},e.prototype.get=function(){var e,r;e=arguments[0],r=Array.prototype.slice.call(arguments,1),cm.assertOfType(e,String),cm.assertOfType(r,cm.arrayOf(Function)),this.routes_.push(new t(e,r))},e.prototype.registerRoute=e.prototype.get,e.prototype.listen=function(){window.addEventListener("popstate",function(){this.historyLength_-=1,this.notify_(this.currentUrlWithoutOrigin_())}.bind(this));var e=this;$(document).on("click","[href]",function(t){href=this.getAttribute("href"),0!=href.indexOf("http")&&(t.preventDefault(),e.navigate(href))}),this.notify_(this.currentUrlWithoutOrigin_())},e.prototype.navigate=function(e){cm.assertArgs(arguments,String),this.addOriginIfNeeded_(e)!=window.location.href&&window.history&&window.history.pushState&&(history.pushState(null,"",e),this.historyLength_+=1,this.notify_(e))},e.prototype.hasHistory=function(){return this.historyLength_>0},e.prototype.back=function(){window.history.back()},e.prototype.notify_=function(e){cm.assertArgs(arguments,String);for(var t=0,r=this.routes_.length;r>t;t++)if(this.routes_[t].attemptToHandleUrl(e))return;this.on404_(e)},e.prototype.currentUrlWithoutOrigin_=function(){return window.location.href.replace(this.getOrigin_(),"")},e.prototype.addOriginIfNeeded_=function(e){return 0==e.indexOf("http")?e:(e="/"==e[0]?e:"/"+e,this.getOrigin_()+e)},e.prototype.getOrigin_=function(){return window.location.origin},cm.define("router.Router",e)}(),function(){function e(e,r){"number"==typeof e&&(r=arguments[0],e=""),t.call(this,e),this.order_=ko.observable(r)}var t=cm.require("viewmodels.ViewModel");cm.inherit(e,t),e.prototype.getOrder=function(){return this.order_()},e.prototype.setOrder=function(e){this.order_(e)},cm.define("viewmodels.ControlViewModel",e)}(),function(){var e,t,r,n;function s(t){cm.assertArgs(arguments,cm.optional(String)),e.call(this,t),this.keysToControlsObservables_={}}e=cm.require("viewmodels.ViewModel"),t=cm.require("viewmodels.ControlViewModel"),r="control_key:",cm.inherit(s,e),s.prototype.getControlsForKey=function(e){return cm.assertArgs(arguments,String),this.getControlsObservableForKey(e)()},s.prototype.getControlsObservableForKey=function(e){return cm.assertArgs(arguments,String),this.getControlsObservableForKeyInternal_(r+e)},s.prototype.addControlAtKey=function(e,n){cm.assertArgs(arguments,String,t),this.addChildAtKey(r+e,n)},s.prototype.removeControlAtKey=function(e,n){return cm.assertArgs(arguments,String,t),this.removeChildAtKey(r+e,n)},s.prototype.getControlsObservableForKeyInternal_=function(e){return cm.assertArgs(arguments,String),this.keysToControlsObservables_[e]||(this.keysToControlsObservables_[e]=ko.pureComputed(this.computeControls_.bind(this,e))),this.keysToControlsObservables_[e]},s.prototype.computeControls_=function(e){var t,i,o,a,l,u,c,h,d,g;for(t=this.getChildrenForKey(e),i=this.getKeys(),o=0,a=i.length;a>o;o++)if(l=i[o],0!=l.indexOf(r))for(u=this.getChildrenForKey(l),c=0,h=u.length;h>c;c++)d=u[c],d instanceof s&&(g=d.getControlsObservableForKeyInternal_(e),t=t.concat(g()));return t.sort(n),t},n=function(e,r){var n,s;return cm.assertArgs(arguments,t,t),n=e.getOrder(),s=r.getOrder(),s>n?-1:n==s?0:1},cm.define("viewmodels.ContentViewModel",s)}(),function(){var e,t,r;function n(r){cm.assertArgs(arguments,e),this.router=new t,this.rootViewModel_=ko.observable(r)}e=cm.require("viewmodels.ViewModel"),t=cm.require("router.Router"),r=cm.require("bindings.Child"),n.prototype.getRootViewModel=function(){return this.rootViewModel_()},n.prototype.setRootViewModel=function(t){cm.assertArgs(arguments,e),this.rootViewModel_(t)},n.prototype.get=function(){var e,t,r;for(e=Array.prototype.slice.call(arguments,1),cm.assertOfType(arguments[0],String),cm.assertOfType(e,cm.arrayOf(Function)),t=0,r=e.length;r>t;t++)e[t]=e[t].bind(this);this.router.get.apply(this.router,arguments)},n.prototype.registerRoute=n.prototype.get,n.prototype.listen=function(){this.router.listen()},n.prototype.setTemplateEngine=function(e){cm.assertArgs(arguments,ko.nativeTemplateEngine),ko.cornerManTemplateEngine=e},n.prototype.bindRootViewModel=function(e){cm.assertArgs(arguments,cm.optional(Node)),r.attachToKnockout(),e=e||document.body,e.setAttribute("data-bind","child: rootViewModel_"),ko.applyBindings(this)},cm.define("CornerMan",n)}(this),function(e){var t,r;t=cm.require("viewmodels.ViewModel"),r=cm.require("CornerMan"),e.CornerMan={CornerMan:r,Router:cm.require("router.Router"),ContentViewModel:cm.require("viewmodels.ContentViewModel"),ControlViewModel:cm.require("viewmodels.ControlViewModel"),ViewModel:t,Events:t.Events},e.CornerMan.createChildObservable=t.createChildObservable,e.CornerMan.createChildrenObservable=t.createChildrenObservable,e.CornerMan.create=function(e){return new r(e)},e.CornerMan.inherit=cm.inherit}(this)})();