/**
 * CornerMan JavaScript library v1.0.2
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */
(function(){(function(e){var t,r,n;t={},e.cm={inherit:function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e},define:function(e,r){var e=e.replace(/\./g,"$");if(t[e])throw Error("Namespace already exists: "+e);t[e]=r},require:function(e){var e=e.replace(/\./g,"$");if(!t[e])throw Error("Unknown namespace: "+e);return t[e]}},r=function(){},n=e.insist||{},e.cm.assertArgs=e.assertArgs||n.args||r,e.cm.assertOfType=e.assertOfType||n.ofType||r,e.cm.assertType=e.assertType||n.isType||r,e.cm.getNameForValue=e.getNameForValue||n.getNameForValue||r,e.cm.getNameForType=e.getNameForType||n.getNameForType||r,e.cm.arrayOf=e.arrayOf||n.arrayOf||r,e.cm.nullable=e.nullable||n.nullable||r,e.cm.anything=e.anything||n.anything||r,e.cm.optional=e.optional||n.optional||r,e.cm.ofEnum=e.ofEnum||n["enum"]||r})(this),function(){var e,t,r,n;function o(e){this.id_=o.generateKey(r),this.template_=ko.observable(e||null),this.hasTemplate=ko.pureComputed(this.computeHasTemplate_.bind(this)),this.parent_=ko.observable(null),this.parent_.subscribe(this.onParentWillChange_,this,"beforeChange"),this.parent_.subscribe(this.onParentChanged_,this,"change"),this.keys_=ko.observableArray(),this.keysToChildrenObservables_={},this.childrenObservable_=ko.pureComputed(this.computeChildrenObservable_.bind(this)),this.eventsToListeners_={},this.childrenIdsToKeys_={}}e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=10,r=16,o.Events={CHILD_ADDED:"child-added",CHILD_MOVED:"child-moved",CHILD_REMOVED:"child-removed",MOVED_KEYS:"self-moved-keys",ADDED_TO_PARENT:"self-added-to-parent",REMOVED_FROM_PARENT:"self-removed-from-parent"},o.generateKey=function(){var r,n,o;for(r=t,n=e,1===arguments.length&&"number"==typeof arguments[0]?r=arguments[0]:1===arguments.length&&"string"==typeof arguments[0]?n=arguments[0]:2===arguments.length&&(r=arguments[0],n=arguments[1]),keySegments=[],o=0;r>o;o++)keySegments.push(n.charAt(Math.floor(Math.random()*n.length)));return keySegments.join("")},o.createChildObservable=function(e,t,r){t=t||o.generateKey();var n=ko.pureComputed({read:function(){return e.getChildrenForKey(t)[0]||null},write:function(r){e.getChildrenForKey(t)[0]!==r&&e.replaceChildrenAtKey(t,r?[r]:[])},owner:e});return n.key_=t,n.viewModel_=e,n.getKey=function(){return n.key_},n.getViewModel=function(){return n.viewModel_},n(r),n},o.createChildrenObservable=function(e,t,r){var o=ko.observableArray();return o.subscribe(n.bind(e,e,t),null,"arrayChange"),o.key_=t,o.viewModel_=e,o.getKey=function(){return o.key_},o.getViewModel=function(){return o.viewModel_},r&&o(r),o},o.prototype.childObservable=function(e,t){var r,n;return t=t||{},r=t.key||o.generateKey(),n=t.viewModel||this,o.createChildObservable(n,r,e)},o.prototype.childrenObservable=function(e,t){var r,n;return t=t||{},r=t.key||o.generateKey(),n=t.viewModel||this,o.createChildrenObservable(n,r,e)},o.prototype.addListener=function(e,t){this.eventsToListeners_[e]||(this.eventsToListeners_[e]=[]),this.eventsToListeners_[e].push(t)},o.prototype.removeListener=function(e){var t,r,n,o;t=!1;for(r in this.eventsToListeners_)for(n=this.eventsToListeners_[r],o=0;n.length>o;o++)e===n[o]&&(t=!0,n.splice(o,1),o--);return t},o.prototype.getParent=function(){return this.parent_()},o.prototype.getTemplate=function(){return this.template_()},o.prototype.getKeys=function(){return this.keys_()},o.prototype.getKeysObservable=function(){return this.keys_},o.prototype.getChildren=function(){return this.childrenObservable_()},o.prototype.getChildrenObservable=function(){return this.childrenObservable_},o.prototype.getChildrenForKey=function(e){return this.getChildrenObservableForKey(e)()},o.prototype.getChildrenObservableForKey=function(e){return this.keysToChildrenObservables_[e]||(this.keysToChildrenObservables_[e]=ko.observableArray([]),this.keys_.push(e)),this.keysToChildrenObservables_[e]},o.prototype.getKeyForChild=function(e){return e.getParent()!=this?null:this.childrenIdsToKeys_[e.id_]||null},o.prototype.addChildAtKey=function(e,t){var r,n,i;return r=t.getParent(),r===this?(n=r.getKeyForChild(t),n===e?!1:(this.removeChildAtKeySilently_(n,t,!1),this.keysToChildrenObservables_[e]?this.keysToChildrenObservables_[e].push([t]):(this.keysToChildrenObservables_[e]=ko.observableArray([t]),this.keys_.push(e)),this.childrenIdsToKeys_[t.id_]=e,t.dispatchEvent_(o.Events.MOVED_KEYS,this,n,e),this.dispatchEvent_(o.Events.CHILD_MOVED,t,n,e),!0)):(i=!this.keysToChildrenObservables_[e],i?(this.keysToChildrenObservables_[e]=ko.observableArray([t]),this.keys_.peek().push(e)):this.keysToChildrenObservables_[e].peek().push(t),this.childrenIdsToKeys_[t.id_]=e,r&&(n=r.getKeyForChild(t),r.removeChildAtKeySilently_(n,t,!0)),t.parent_(this),i?this.keys_.valueHasMutated():this.keysToChildrenObservables_[e].valueHasMutated(),!0)},o.prototype.addChildrenAtKey=function(e,t){for(var r=0,n=t.length;n>r;r++)this.addChildAtKey(e,t[r])},o.prototype.addChild=function(e){var t=o.generateKey();return this.addChildAtKey(t,e),t},o.prototype.addChildren=function(e){var t=o.generateKey();return this.addChildrenAtKey(t,e),t},o.prototype.removeChildAtKey=function(e,t){var r=this.removeChildAtKeySilently_(e,t,!0);return r&&t.parent_(null),r},o.prototype.removeChild=function(e){var t=this.getKeyForChild(e);return t?this.removeChildAtKey(t,e):!1},o.prototype.replaceChildrenAtKey=function(e,t){var r,n,o;for(r=this.getChildrenForKey(e),n=0,o=r.length;o>n;n++)this.removeChildAtKey(e,r[n]);this.addChildrenAtKey(e,t)},o.prototype.computeChildrenObservable_=function(){var e,t,r,n;for(e=this.keys_(),e.sort(),t=[],r=0,n=e.length;n>r;r++)t=t.concat(this.getChildrenForKey(e[r]));return t},o.prototype.computeHasTemplate_=function(){return null!=this.template_()},o.prototype.removeChildAtKeySilently_=function(e,t,r){if(!this.keysToChildrenObservables_[e])return!1;var n=this.keysToChildrenObservables_[e].remove(t);return n&&n.length?(r||delete this.childrenIdsToKeys_[t.id_],!0):!1},o.prototype.dispatchEvent_=function(){var e,t,r,n,o;if(e=arguments[0],t=Array.prototype.slice.call(arguments,1),r=this.eventsToListeners_[e])for(n=0,o=r.length;o>n;n++)r[n].apply(this,t)},o.prototype.onParentWillChange_=function(e){if(e){var t=e.childrenIdsToKeys_[this.id_];t&&(delete e.childrenIdsToKeys_[this.id_],this.dispatchEvent_(o.Events.REMOVED_FROM_PARENT,e,t),e.dispatchEvent_(o.Events.CHILD_REMOVED,this,t))}},o.prototype.onParentChanged_=function(e){if(e){var t=e.getKeyForChild(this);this.dispatchEvent_(o.Events.ADDED_TO_PARENT,e,t),e.dispatchEvent_(o.Events.CHILD_ADDED,this,t)}},n=function(e,t,r){var n,o,i,s,a,l,h;for(n=0,o=r.length;o>n;n++){for(i=r[n],s=!1,a=0,l=r.length;l>a;a++)if(h=r[a],"added"===h.status&&"deleted"===i.status||"deleted"===h.status&&"added"===i.status){s=!0;break}s||("added"===i.status?e.addChildAtKey(t,i.value):"deleted"===i.status&&e.removeChildAtKey(t,i.value))}},cm.define("viewmodels.ViewModel",o)}(),function(){var e,t,r,n,o;e=cm.require("viewmodels.ViewModel"),t=function(e){var e=e;return function(){return e}},r=function(e,t){var r=function(e){return e.getTemplate()};return function(){return{name:r,foreach:e,"if":t,templateEngine:ko.cornerManTemplateEngine||null}}},n=function(n,o,i,s){var a,l,h,u,d,c;return(a=ko.unwrap(o()))?(l=null,h=null,u=!0,d=function(t){if(t instanceof e)l=t;else if(t instanceof Array)if(s)h=t;else if(l=t[0],!l)return null},a instanceof e||a instanceof Array?d(a):"string"==typeof a?d(i.getChildrenForKey(a)):(c="string"==typeof a.data?i.getChildrenForKey(a.data):a.data,d(c),u=a["if"]?a["if"]:u),l?t({name:l.template_,data:l,"if":u,templateEngine:ko.cornerManTemplateEngine||null}):h?r(h,u):t({})):null},o=function(){var e,t;e=ko.bindingHandlers.template.init,t=ko.bindingHandlers.template.update,ko.bindingHandlers.child={init:function(t,r,o,i,s){var a=n(t,r,s.$data,!1);return a?e(t,a,o,i,s):void 0},update:function(e,r,o,i,s){var a=n(e,r,s.$data,!1);return a?t(e,a,o,i,s):void 0}},ko.bindingHandlers.children={init:function(t,r,o,i,s){var a=n(t,r,s.$data,!0);return a?e(t,a,o,i,s):void 0},update:function(e,r,o,i,s){var a=n(e,r,s.$data,!0);return a?t(e,a,o,i,s):void 0}}},cm.define("bindings.Child",{attachToKnockout:o})}(),function(){function e(e,t){var e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");this.slugs_=(e.match(/\/:(\w+)/g)||[]).map(function(e){return e.substring(2)}),this.regex_=RegExp(e.replace(/\/:(\w+)/g,"/([\\w-]+)")),this.callbacks_=t}e.prototype.attemptToHandleUrl=function(e){var t,r,n,o,i,s,a,l,h;if(this.regex_.lastIndex=0,t=e.replace(/\?.*/,""),"/"==t[t.length-1]&&(t=t.substring(0,t.length-1)),r=e.match(/\?.*/),n=r&&r[0]?r[0]:"",o=this.regex_.exec(t),null!=o&&o[0].length==t.length){if(i={},this.slugs_)for(i.params={},s=0,a=this.slugs_.length;a>s;s++)i.params[this.slugs_[s]]=o[s+1];if(n.length)for(i.query={},l=n.match(/[\w=$+%@#^()]+/g),s=0,a=l.length;a>s;s++)h=l[s].split("="),i.query[h[0]]=h[1]||!0;return this.fireCallbacks_(i),!0}return!1},e.prototype.fireCallbacks_=function(e){var t,r,n;t=0,r=this.callbacks_.length,n=function(){t++,r>t&&this.callbacks_[t](e,n)}.bind(this),this.callbacks_[t](e,n)},cm.define("router.Route",e)}(),function(){function e(e){this.on404_=e||function(e){console.log("404 at",e)},this.routes_=[],this.historyLength_=0}var t=cm.require("router.Route");e.prototype.setOn404=function(e){this.on404_=e},e.prototype.get=function(){var e,r;e=arguments[0],r=Array.prototype.slice.call(arguments,1),this.routes_.push(new t(e,r))},e.prototype.registerRoute=e.prototype.get,e.prototype.listen=function(){window.addEventListener("popstate",function(){this.historyLength_-=1,this.notify_(this.currentUrlWithoutOrigin_())}.bind(this));var e=this;$(document).on("click","[href]",function(t){href=this.getAttribute("href"),0!=href.indexOf("http")&&(t.preventDefault(),e.navigate(href))}),this.notify_(this.currentUrlWithoutOrigin_())},e.prototype.navigate=function(e){this.addOriginIfNeeded_(e)!=window.location.href&&window.history&&window.history.pushState&&(history.pushState(null,"",e),this.historyLength_+=1,this.notify_(e))},e.prototype.hasHistory=function(){return this.historyLength_>0},e.prototype.back=function(){window.history.back()},e.prototype.notify_=function(e){for(var t=0,r=this.routes_.length;r>t;t++)if(this.routes_[t].attemptToHandleUrl(e))return;this.on404_(e)},e.prototype.currentUrlWithoutOrigin_=function(){return window.location.href.replace(this.getOrigin_(),"")},e.prototype.addOriginIfNeeded_=function(e){return 0==e.indexOf("http")?e:(e="/"==e[0]?e:"/"+e,this.getOrigin_()+e)},e.prototype.getOrigin_=function(){return window.location.origin},cm.define("router.Router",e)}(),function(){function e(e,r){"number"==typeof e&&(r=arguments[0],e=""),t.call(this,e),this.order_=ko.observable(r)}var t=cm.require("viewmodels.ViewModel");cm.inherit(e,t),e.prototype.getOrder=function(){return this.order_()},e.prototype.setOrder=function(e){this.order_(e)},cm.define("viewmodels.ControlViewModel",e)}(),function(){var e,t,r;function n(t){e.call(this,t),this.keysToControlsObservables_={}}e=cm.require("viewmodels.ViewModel"),cm.require("viewmodels.ControlViewModel"),t="control_key:",cm.inherit(n,e),n.prototype.getControlsForKey=function(e){return this.getControlsObservableForKey(e)()},n.prototype.getControlsObservableForKey=function(e){return this.getControlsObservableForKeyInternal_(t+e)},n.prototype.addControlAtKey=function(e,r){this.addChildAtKey(t+e,r)},n.prototype.removeControlAtKey=function(e,r){return this.removeChildAtKey(t+e,r)},n.prototype.getControlsObservableForKeyInternal_=function(e){return this.keysToControlsObservables_[e]||(this.keysToControlsObservables_[e]=ko.pureComputed(this.computeControls_.bind(this,e))),this.keysToControlsObservables_[e]},n.prototype.computeControls_=function(e){var o,i,s,a,l,h,u,d,c,p;for(o=this.getChildrenForKey(e),i=this.getKeys(),s=0,a=i.length;a>s;s++)if(l=i[s],0!=l.indexOf(t))for(h=this.getChildrenForKey(l),u=0,d=h.length;d>u;u++)c=h[u],c instanceof n&&(p=c.getControlsObservableForKeyInternal_(e),o=o.concat(p()));return o.sort(r),o},r=function(e,t){var r,n;return r=e.getOrder(),n=t.getOrder(),n>r?-1:r==n?0:1},cm.define("viewmodels.ContentViewModel",n)}(),function(){var e,t;function r(t){this.router=new e,this.rootViewModel_=ko.observable(t)}cm.require("viewmodels.ViewModel"),e=cm.require("router.Router"),t=cm.require("bindings.Child"),r.prototype.getRootViewModel=function(){return this.rootViewModel_()},r.prototype.setRootViewModel=function(e){this.rootViewModel_(e)},r.prototype.get=function(){var e,t,r;for(e=Array.prototype.slice.call(arguments,1),t=0,r=e.length;r>t;t++)e[t]=e[t].bind(this);this.router.get.apply(this.router,arguments)},r.prototype.registerRoute=r.prototype.get,r.prototype.listen=function(){this.router.listen()},r.prototype.setTemplateEngine=function(e){ko.cornerManTemplateEngine=e},r.prototype.bindRootViewModel=function(e){t.attachToKnockout(),e=e||document.body,e.setAttribute("data-bind","child: rootViewModel_"),ko.applyBindings(this)},cm.define("CornerMan",r)}(this),function(e){var t,r;t=cm.require("viewmodels.ViewModel"),r=cm.require("CornerMan"),e.CornerMan={CornerMan:r,Router:cm.require("router.Router"),ContentViewModel:cm.require("viewmodels.ContentViewModel"),ControlViewModel:cm.require("viewmodels.ControlViewModel"),ViewModel:t,Events:t.Events},e.CornerMan.createChildObservable=t.createChildObservable,e.CornerMan.createChildrenObservable=t.createChildrenObservable,e.CornerMan.create=function(e){return new r(e)},e.CornerMan.inherit=cm.inherit}(this)})();